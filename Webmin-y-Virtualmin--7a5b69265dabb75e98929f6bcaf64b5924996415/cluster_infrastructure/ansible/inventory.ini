# Inventario dinámico para clúster Enterprise Webmin/Virtualmin
# Este archivo se genera automáticamente desde Terraform

[all:vars]
ansible_user=ubuntu
ansible_ssh_private_key_file=~/.ssh/cluster-key.pem
ansible_python_interpreter=/usr/bin/python3
ansible_ssh_common_args='-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null'

# Nodos de balanceo de carga
[load_balancers]
# IPs generadas por Terraform - módulo load_balancers

# Nodos web (Webmin/Virtualmin)
[web_nodes]
# IPs generadas por Terraform - módulo web_nodes

# Nodos API
[api_nodes]
# IPs generadas por Terraform - módulo api_nodes

# Nodos de base de datos (MariaDB Galera)
[database_nodes]
# IPs generadas por Terraform - módulo database_nodes

# Nodos de almacenamiento (GlusterFS)
[storage_nodes]
# IPs generadas por Terraform - módulo storage_nodes

# Nodos de monitoreo (Prometheus/Grafana)
[monitoring_nodes]
# IPs generadas por Terraform - módulo monitoring_nodes

# Nodos de backup
[backup_nodes]
# IPs generadas por Terraform - módulo backup_nodes

# Grupos compuestos para configuración
[galera_cluster:children]
database_nodes

[glusterfs_cluster:children]
storage_nodes

[web_cluster:children]
web_nodes
api_nodes

[monitoring_cluster:children]
monitoring_nodes

[backup_cluster:children]
backup_nodes

# Configuración especial para HA
[masters]
# Primer nodo de cada tipo para configuración inicial

[workers:children]
web_nodes
api_nodes
database_nodes
storage_nodes
backup_nodes

# Variables específicas por grupo
[load_balancers:vars]
haproxy_role=primary
keepalived_role=MASTER
keepalived_priority=100

[web_nodes:vars]
webmin_install=true
virtualmin_install=true
php_versions=["7.4", "8.0", "8.1", "8.2", "8.3"]
cms_frameworks=["wordpress", "drupal", "joomla", "laravel", "symfony"]

[api_nodes:vars]
webmin_api=true
virtualmin_api=true
api_rate_limit=1000
api_timeout=30

[database_nodes:vars]
mariadb_galera=true
galera_cluster_name=webmin_cluster
galera_wsrep_provider=/usr/lib/galera/libgalera_smm.so
innodb_buffer_pool_size=4G
max_connections=1000

[storage_nodes:vars]
glusterfs_volume_name=gv0
glusterfs_brick_path=/data/glusterfs/brick1
glusterfs_replica_count=3

[monitoring_nodes:vars]
prometheus_retention=30d
grafana_admin_user=admin
grafana_admin_password="{{ lookup('env', 'GRAFANA_ADMIN_PASSWORD') }}"
alertmanager_smtp_host=smtp.gmail.com
alertmanager_smtp_port=587

[backup_nodes:vars]
backup_retention_days=30
backup_encryption_key="{{ lookup('env', 'BACKUP_ENCRYPTION_KEY') }}"
backup_s3_bucket=webmin-cluster-backups
backup_schedule="0 2 * * *"