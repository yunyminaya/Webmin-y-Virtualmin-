try{const e=document.querySelector("html"),t="data-platform";if(navigator.userAgentData&&navigator.userAgentData.platform){const n=navigator.userAgentData.platform.toLowerCase();if(n.includes("linux")){e.setAttribute(t,"linux")}else if(n.includes("windows")){e.setAttribute(t,"windows")}else if(n.includes("mac")){e.setAttribute(t,"macos")}}else if(navigator.platform){const n=navigator.platform.toLowerCase();if(n.includes("linux")){e.setAttribute(t,"linux")}else if(n.includes("win")){e.setAttribute(t,"windows")}else if(n.includes("mac")){e.setAttribute(t,"macos")}}}catch(e){console.warn("Failed to detect platform:",e)}function theme_spinner(e,t,n){const r="cspinner_container";e=e?e:document.querySelector("button i.fa-sign-in:not(.invisible)")||document.querySelector("button i.fa-qrcode:not(.invisible)"),s='<span class="'+r+'"><span class="cspinner">'+'<span class="cspinner-icon white small"></span></span></span>';if(e&&!t){e.classList.add("invisible");e.insertAdjacentHTML("afterend",s);e.parentNode.classList.add("disabled");e.parentNode.disabled=true}else if(e&&t){e.classList.remove("invisible");e.parentNode.classList.remove("disabled");e.parentNode.disabled=false;const t=e.parentNode.querySelector("."+r);if(t){t.parentNode.removeChild(t)}if(n){e.className="fa2 fa2-marker-check";e.parentNode.classList.add("disabled")}}}function theme_content_loaded(){const e=typeof theme_language==="object"?theme_language:{},t=".container.session_login",n=".session_login_back.forgot",r=document.querySelector('input[name="user"]'),o=document.querySelector('input[name="pass"]'),s=function(){const e=new URL(window.location.href);e.search="";history.replaceState({},document.title,e)},i=function(e,t){const n=(e?"faa-bounce animated":"faa-horizontal animated").split(" ");t.classList.add(...n);setTimeout(()=>{t.classList.remove(...n)},1500)};(function(){const e=document.querySelectorAll('input[type="password"]');e.forEach(e=>{const t=document.createElement("span");t.classList.add("input_warning_caps");t.setAttribute("title","Caps Lock");t.classList.add("large");e.classList.add("use_input_warning_caps");e.parentNode.insertBefore(t,e.nextSibling);e.addEventListener("blur",function(){this.nextSibling.classList.remove("visible")});e.addEventListener("keydown",function(e){if(typeof e.getModifierState==="function"){let t;if(e.keyCode===20){t=!e.getModifierState("CapsLock")}else{t=e.getModifierState("CapsLock")}if(t){this.nextSibling.classList.add("visible")}else{this.nextSibling.classList.remove("visible")}}})})})();(function(){const n=document.querySelector('[name="twofactor"]');if(n){const s=document.querySelector('[data-submit="2fa"]'),a=s.querySelector("i"),c=s.getAttribute("data-prefix"),l=location.origin+(c||""),u=document.querySelector('[name="save"]'),f=n.closest("form"),d=f.getAttribute("action")||url.toString(),p=function(s){s.preventDefault();theme_spinner(a);const c=new URLSearchParams;c.append("user",r.value);c.append("pass",o.value);if(u){c.append("save",u.checked?1:0)}c.append("twofactor",n.value);fetch(d,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c}).then(t=>{if(t.url){m=t.url}if(!t.ok){throw new Error(e.session_neterror)}return t.text()}).then(e=>{const n=new DOMParser,r=n.parseFromString(e,"text/html");const o=r.querySelector(t);if(o){theme_spinner(a,true);const e=document.querySelector(t),n=e.querySelectorAll(".alert");n.forEach(e=>e.remove());const o=r.querySelector(".alert");if(o){e.insertBefore(o.cloneNode(true),e.firstChild);i(false,e.querySelector(".alert"))}return}location.href=m}).catch(e=>{location.href=m})};let m=l;if(n){n.addEventListener("keydown",function(e){if(e.key==="Enter"){e.preventDefault();if(s)s.click();return false}})}f.addEventListener("submit",function(i){i.preventDefault();const a=new URLSearchParams;a.append("user",r.value);a.append("pass",o.value);if(u){a.append("save",u.checked?1:0)}a.append("twofprobe",1);fetch(d,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a}).then(t=>{if(t.url){m=t.url}if(t.status===401){return{needsTwoFactor:true}}else if(!t.ok){throw new Error(e.session_neterror)}else{return t.text().then(e=>{return{needsTwoFactor:false,htmlResponse:e}})}}).then(e=>{if(e.needsTwoFactor){const e=document.querySelector(".session_login_flipper");e.classList.toggle("flipped");e.classList.toggle("twofactor");const t=document.querySelector(".alert");if(t){t.remove()}setTimeout(()=>{n.focus()},600);s.removeEventListener("click",p);s.addEventListener("click",p);return}else{const n=e.htmlResponse,r=new DOMParser,s=r.parseFromString(n,"text/html");const i=document.querySelector(t),a=s.querySelector(t);if(i&&a){i.innerHTML=a.innerHTML;theme_content_loaded();setTimeout(()=>{o.focus()});return}location.href=m}}).catch(e=>{console.warn("Request failed:",e);location.href=m})})}})();(function(){const a=document.querySelector(n+" .form-signin-group > .btn-success"),c=document.querySelector(".session_login_flipper"),l=c.querySelectorAll("[data-flipper]"),u=document.querySelector(n+' input[name="forgot"]'),f=document.querySelector(n+" [data-unlocker]"),d=document.querySelector(n+' input[name="newpass"]'),p=document.querySelector(n+' input[name="newpass2"]'),m=u&&u.dataset&&u.dataset.return,h=d&&d.dataset&&d.dataset.return,g=t,w=function(){const e=c,t=e.classList.contains("forgot");!t&&e.classList.toggle("flipping",true);!t&&e.classList.toggle("forgot",true);setTimeout(()=>{t&&e.classList.toggle("flipping",false);t&&e.classList.toggle("forgot",false)},600);e.classList.toggle("flipped");const n=!e.classList.contains("flipped")?r:document.querySelector('input[name="forgot"]');if(n){setTimeout(()=>{if(e.classList.contains("flipped")||!n.value.trim()){n.focus()}else if(o){o.focus()}},600)}},v=function(e){let t=e.querySelector(".panel-body > [data-fatal-error-text]");if(!t||!t.textContent.trim()){t=e.querySelector(".panel-body > .err-content")}return t},y=function(t,n,r){let o=document.querySelector(g+" > .alert");if(o){o.remove()}o=document.createElement("div");o.className="alert";o.innerHTML=`\n                    <strong><i class="fa"></i> </strong><br>\n                    <span></span>`;const s=document.querySelector(g);if(s){s.insertBefore(o,s.firstChild)}o.classList.remove("alert-warning","alert-success","alert-danger");const a=o.querySelector(".fa"),c=o.querySelector("strong"),l=o.querySelector("span");if(t==="success"){i(true,o);o.classList.add("alert-success");if(!r){r="check-circle"}if(a)a.className="fa fa-"+r;if(c)c.innerHTML='<i class="fa fa-'+r+'"></i> '+e.session_success;if(l)l.innerHTML=n}else{i(false,o);o.classList.add("alert-danger");if(!r){r="exclamation-circle"}if(a)a.className="fa fa-"+r;if(c)c.innerHTML='<i class="fa fa-'+r+'"></i> '+e.session_error;if(l)l.textContent=n}};if(m){setTimeout(()=>{w()},60)}if(l){l.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=this.dataset.webmin;if(t){const e=(location.origin+location.pathname.replace(/\/[^\/]*\.[^\/]*$/,"")).replace(/\/$/,""),n=encodeURIComponent(e);location.href=`${t}?return=${n}`;return}if(m||h){e.stopImmediatePropagation();location.href=m||h;return}w()})})}if(u){u.addEventListener("keydown",function(e){if(e.key==="Enter"){e.preventDefault();if(a)a.click();return false}})}if(d){d.addEventListener("keydown",function(e){if(e.key==="Enter"){e.preventDefault();if(p)p.focus();return false}});if(p){p.addEventListener("keydown",function(e){if(e.key==="Enter"){e.preventDefault();if(f)f.click();return false}})}}if(a){a.addEventListener("click",function(t){t.preventDefault();if(this.classList.contains("disabled")){return}if(!u||!u.value.trim()){y("error",e.session_cannot);return}const n=u.value.trim(),r=this.querySelector("i");theme_spinner(r);let o=`forgot=${encodeURIComponent(n)}`;if(m){o+=`&return=${encodeURIComponent(m)}`}fetch("forgot_send.cgi",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:o}).then(t=>{if(t.url){serverRedirectUrl=t.url}if(!t.ok){throw new Error(e.session_neterror)}return t.text()}).then(t=>{const n=new DOMParser,o=n.parseFromString(t,"text/html");const s=o.querySelector(".panel-body > center");if(s&&s.textContent.trim()){theme_spinner(r,true,true);y("success",s.innerHTML.trim());return}theme_spinner(r,true);const i=v(o);if(i&&i.textContent.trim()){y("error",i.textContent.trim());u.focus();return}y("error",e.session_unkerror)}).catch(t=>{theme_spinner(r,true);console.warn("Request failed:",t);y("error",e.session_conerror)})})}if(f){const t=document.querySelector(n),i=function(){t.remove();s();const e=document.querySelector(g+" .alert");if(e){e.remove()}location.reload()};if(l.length>1){l[1].addEventListener("click",function(e){e.preventDefault();i()})}if(d){setTimeout(()=>{d.focus()},0)}f.addEventListener("click",function(n){n.preventDefault();if(this.classList.contains("disabled")){return}if(!d||!d.value.length){y("error",e.session_resetepassreq);return}if(!p||!p.value.length){y("error",e.session_pwdconf);return}const s=d.value;const i=p.value;if(s!==i){y("error",e.session_pwdmatch);return}const a=t?t.getAttribute("data-forgot"):null,c=t?t.getAttribute("data-username"):null;if(!a){y("error",e.session_noid);return}const u=this.querySelector("i");theme_spinner(u);fetch("forgot.cgi",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`id=${encodeURIComponent(a)}&newpass=${encodeURIComponent(s)}&newpass2=${encodeURIComponent(i)}`}).then(t=>{if(t.url){serverRedirectUrl=t.url}if(!t.ok){throw new Error(e.session_neterror)}return t.text()}).then(n=>{const s=new DOMParser,i=s.parseFromString(n,"text/html");const a=v(i);if(a&&a.textContent.trim()){theme_spinner(u,true);y("error",a.textContent.trim());return}if(h){const e=encodeURIComponent(t.getAttribute("data-username"));location.href=`${h}?returned-username=${e}`;return}theme_spinner(u,true,true);l[0].click();y("success",e.session_pwdsucc,"unlock");const f=new URL(window.location.href);f.search="";history.replaceState({},document.title,f);if(c){r.value=c;if(o){o.focus()}}}).catch(t=>{theme_spinner(u,true);console.warn("Request failed:",t);y("error",e.session_conerror)})})}})();(function(){const e=document.querySelectorAll(t+" > .alert");if(e){e.forEach(e=>{setTimeout(()=>{e.classList.remove("animated")},1500)})}})();if(o&&o.hasAttribute("autofocus")){setTimeout(()=>{o.focus()},0)}if(r&&r.hasAttribute("autofocus")){setTimeout(()=>{r.focus()},0)}}document.addEventListener("DOMContentLoaded",theme_content_loaded);