# Configuración Apache para Dashboard SSL
# Ubicación: /etc/apache2/ssl_dashboard.conf

<VirtualHost *:443>
    ServerName ssl-dashboard.localhost
    DocumentRoot /var/www/html/ssl_dashboard

    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/localhost/cert.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/localhost/privkey.pem
    SSLCertificateChainFile /etc/letsencrypt/live/localhost/chain.pem

    <Directory /var/www/html/ssl_dashboard>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted

        # Headers de seguridad adicionales para dashboard
        Header always set X-Frame-Options SAMEORIGIN
        Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'"
    </Directory>

    # API endpoint para datos de certificados
    ScriptAlias /ssl_dashboard/api/certificates /var/www/html/ssl_dashboard/api_certificates.sh

    <Location /ssl_dashboard/api/certificates>
        SetHandler cgi-script
        Options +ExecCGI
        Require all granted
    </Location>

    ErrorLog ${APACHE_LOG_DIR}/ssl_dashboard_error.log
    CustomLog ${APACHE_LOG_DIR}/ssl_dashboard_access.log combined
</VirtualHost>

# Alias para acceder al dashboard desde cualquier dominio
Alias /ssl-dashboard /var/www/html/ssl_dashboard

<Location /ssl-dashboard>
    Require all granted
    Options Indexes FollowSymLinks
</Location>