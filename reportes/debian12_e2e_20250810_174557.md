# Prueba E2E Debian 12 - instalacion_un_comando.sh (fqdn fixes)
Fecha: Sun Aug 10 17:45:57 UTC 2025
- ID=debian VERSION_ID=12 ARCH=aarch64

## Hostname inicial
hostname: dcf62950f2cb
hostname -f: dcf62950f2cb

## Ejecutando instalacion
+ set -euo pipefail
+ export TERM=xterm
+ TERM=xterm
+ RED='\033[0;31m'
+ GREEN='\033[0;32m'
+ YELLOW='\033[1;33m'
+ BLUE='\033[0;34m'
+ PURPLE='\033[0;35m'
+ CYAN='\033[0;36m'
+ WHITE='\033[1;37m'
+ NC='\033[0m'
+ SCRIPT_VERSION=2.0
+ INSTALL_LOG=/var/log/webmin-virtualmin-install.log
+ TEMP_DIR=/tmp/webmin-virtualmin-install
++ date +%Y%m%d_%H%M%S
+ BACKUP_DIR=/root/webmin-virtualmin-backup-20250810_174557
+ DISTRO=
+ VERSION=
+ PACKAGE_MANAGER=
+ WEBMIN_PORT=10000
+ VIRTUALMIN_LICENSE_KEY=
+ SKIP_CONFIRMATION=false
+ ENABLE_SSL=true
+ INSTALL_AUTHENTIC_THEME=true
+ CONFIGURE_FIREWALL=true
+ OPTIMIZE_FOR_PRODUCTION=true
+ trap 'error_handler ${LINENO} $?' ERR
+ [[ /workspace/instalacion_un_comando.sh == \/\w\o\r\k\s\p\a\c\e\/\i\n\s\t\a\l\a\c\i\o\n\_\u\n\_\c\o\m\a\n\d\o\.\s\h ]]
+ main
+ show_banner
+ clear
[H[2J[3J+ cat
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   üöÄ INSTALACI√ìN AUTOM√ÅTICA WEBMIN Y VIRTUALMIN - UN SOLO COMANDO
   
   ‚ú® Completamente autom√°tico y a prueba de errores
   üõ°Ô∏è Validaci√≥n continua y recuperaci√≥n autom√°tica
   üîß Optimizado para Ubuntu 20.04 LTS y Debian 10+
   üì¶ Incluye Authentic Theme y configuraci√≥n SSL
   
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
+ echo

++ dirname /var/log/webmin-virtualmin-install.log
+ mkdir -p /var/log
++ date
+ echo '=== INSTALACI√ìN WEBMIN/VIRTUALMIN INICIADA Sun Aug 10 17:45:57 UTC 2025 ==='
+ log INFO 'Iniciando instalaci√≥n autom√°tica v2.0'
+ local level=INFO
+ shift
+ local 'message=Iniciando instalaci√≥n autom√°tica v2.0'
++ date '+%Y-%m-%d %H:%M:%S'
+ local 'timestamp=2025-08-10 17:45:57'
+ case "$level" in
+ echo -e '\033[0;34m[INFO]\033[0m Iniciando instalaci√≥n autom√°tica v2.0'
[0;34m[INFO][0m Iniciando instalaci√≥n autom√°tica v2.0
+ echo '[2025-08-10 17:45:57] [INFO] Iniciando instalaci√≥n autom√°tica v2.0'
+ log INFO 'Log de instalaci√≥n: /var/log/webmin-virtualmin-install.log'
+ local level=INFO
+ shift
+ local 'message=Log de instalaci√≥n: /var/log/webmin-virtualmin-install.log'
++ date '+%Y-%m-%d %H:%M:%S'
+ local 'timestamp=2025-08-10 17:45:57'
+ case "$level" in
+ echo -e '\033[0;34m[INFO]\033[0m Log de instalaci√≥n: /var/log/webmin-virtualmin-install.log'
[0;34m[INFO][0m Log de instalaci√≥n: /var/log/webmin-virtualmin-install.log
+ echo '[2025-08-10 17:45:57] [INFO] Log de instalaci√≥n: /var/log/webmin-virtualmin-install.log'
+ check_root
+ [[ 0 -ne 0 ]]
+ log SUCCESS 'Privilegios de root verificados'
+ local level=SUCCESS
+ shift
+ local 'message=Privilegios de root verificados'
++ date '+%Y-%m-%d %H:%M:%S'
+ local 'timestamp=2025-08-10 17:45:57'
+ case "$level" in
+ echo -e '\033[0;32m[‚úì]\033[0m Privilegios de root verificados'
[0;32m[‚úì][0m Privilegios de root verificados
+ echo '[2025-08-10 17:45:57] [SUCCESS] Privilegios de root verificados'
+ detect_system
+ log HEADER 'DETECCI√ìN DEL SISTEMA'
+ local level=HEADER
+ shift
+ local 'message=DETECCI√ìN DEL SISTEMA'
++ date '+%Y-%m-%d %H:%M:%S'
+ local 'timestamp=2025-08-10 17:45:57'
+ case "$level" in
+ echo

+ echo -e '\033[0;35m=== DETECCI√ìN DEL SISTEMA ===\033[0m'
[0;35m=== DETECCI√ìN DEL SISTEMA ===[0m
+ echo '[2025-08-10 17:45:57] [HEADER] DETECCI√ìN DEL SISTEMA'
+ [[ ! -f /etc/os-release ]]
+ source /etc/os-release
++ PRETTY_NAME='Debian GNU/Linux 12 (bookworm)'
++ NAME='Debian GNU/Linux'
++ VERSION_ID=12
++ VERSION='12 (bookworm)'
++ VERSION_CODENAME=bookworm
++ ID=debian
++ HOME_URL=https://www.debian.org/
++ SUPPORT_URL=https://www.debian.org/support
++ BUG_REPORT_URL=https://bugs.debian.org/
+ DISTRO=debian
+ VERSION=12
+ case "$DISTRO" in
+ PACKAGE_MANAGER=apt
+ [[ 12 -ge 10 ]]
+ log SUCCESS 'Sistema detectado: Debian 12 (Compatible)'
+ local level=SUCCESS
+ shift
+ local 'message=Sistema detectado: Debian 12 (Compatible)'
++ date '+%Y-%m-%d %H:%M:%S'
+ local 'timestamp=2025-08-10 17:45:57'
+ case "$level" in
+ echo -e '\033[0;32m[‚úì]\033[0m Sistema detectado: Debian 12 (Compatible)'
[0;32m[‚úì][0m Sistema detectado: Debian 12 (Compatible)
+ echo '[2025-08-10 17:45:57] [SUCCESS] Sistema detectado: Debian 12 (Compatible)'
++ uname -m
+ local arch=aarch64
+ [[ aarch64 != \x\8\6\_\6\4 ]]
+ log WARNING 'Arquitectura no optimizada: aarch64 (recomendado: x86_64)'
+ local level=WARNING
+ shift
+ local 'message=Arquitectura no optimizada: aarch64 (recomendado: x86_64)'
++ date '+%Y-%m-%d %H:%M:%S'
+ local 'timestamp=2025-08-10 17:45:57'
+ case "$level" in
+ echo -e '\033[1;33m[‚ö†]\033[0m Arquitectura no optimizada: aarch64 (recomendado: x86_64)'
[1;33m[‚ö†][0m Arquitectura no optimizada: aarch64 (recomendado: x86_64)
+ echo '[2025-08-10 17:45:57] [WARNING] Arquitectura no optimizada: aarch64 (recomendado: x86_64)'
+ log INFO 'Distribuci√≥n: debian 12'
+ local level=INFO
+ shift
+ local 'message=Distribuci√≥n: debian 12'
++ date '+%Y-%m-%d %H:%M:%S'
+ local 'timestamp=2025-08-10 17:45:57'
+ case "$level" in
+ echo -e '\033[0;34m[INFO]\033[0m Distribuci√≥n: debian 12'
[0;34m[INFO][0m Distribuci√≥n: debian 12
+ echo '[2025-08-10 17:45:57] [INFO] Distribuci√≥n: debian 12'
+ log INFO 'Arquitectura: aarch64'
+ local level=INFO
+ shift
+ local 'message=Arquitectura: aarch64'
++ date '+%Y-%m-%d %H:%M:%S'
+ local 'timestamp=2025-08-10 17:45:57'
+ case "$level" in
+ echo -e '\033[0;34m[INFO]\033[0m Arquitectura: aarch64'
[0;34m[INFO][0m Arquitectura: aarch64
+ echo '[2025-08-10 17:45:57] [INFO] Arquitectura: aarch64'
+ log INFO 'Gestor de paquetes: apt'
+ local level=INFO
+ shift
+ local 'message=Gestor de paquetes: apt'
++ date '+%Y-%m-%d %H:%M:%S'
+ local 'timestamp=2025-08-10 17:45:57'
+ case "$level" in
+ echo -e '\033[0;34m[INFO]\033[0m Gestor de paquetes: apt'
[0;34m[INFO][0m Gestor de paquetes: apt
+ echo '[2025-08-10 17:45:57] [INFO] Gestor de paquetes: apt'
+ ensure_fqdn
+ log HEADER 'VALIDACI√ìN DE HOSTNAME (FQDN)'
+ local level=HEADER
+ shift
+ local 'message=VALIDACI√ìN DE HOSTNAME (FQDN)'
++ date '+%Y-%m-%d %H:%M:%S'
+ local 'timestamp=2025-08-10 17:45:57'
+ case "$level" in
+ echo

+ echo -e '\033[0;35m=== VALIDACI√ìN DE HOSTNAME (FQDN) ===\033[0m'
[0;35m=== VALIDACI√ìN DE HOSTNAME (FQDN) ===[0m
+ echo '[2025-08-10 17:45:57] [HEADER] VALIDACI√ìN DE HOSTNAME (FQDN)'
+ local current_fqdn
++ hostname -f
+ current_fqdn=dcf62950f2cb
+ local 'bad_suffix_re=\.local(domain)?$'
+ [[ -n panel.example.com ]]
+ local fqdn=panel.example.com
+ local short=panel
+ log INFO 'Usando FQDN_OVERRIDE: panel.example.com'
+ local level=INFO
+ shift
+ local 'message=Usando FQDN_OVERRIDE: panel.example.com'
++ date '+%Y-%m-%d %H:%M:%S'
+ local 'timestamp=2025-08-10 17:45:57'
+ case "$level" in
+ echo -e '\033[0;34m[INFO]\033[0m Usando FQDN_OVERRIDE: panel.example.com'
[0;34m[INFO][0m Usando FQDN_OVERRIDE: panel.example.com
+ echo '[2025-08-10 17:45:57] [INFO] Usando FQDN_OVERRIDE: panel.example.com'
+ echo panel.example.com
+ command -v hostnamectl
+ hostnamectl set-hostname panel.example.com --static --transient --pretty
+ hostname panel.example.com
+ command -v hostname
+ hostname -F /etc/hostname
+ export HOSTNAME=panel.example.com
+ HOSTNAME=panel.example.com
+ grep -qE '^127\.0\.1\.1[[:space:]]' /etc/hosts
+ sed -i 's/^127\.0\.1\.1.*/127.0.1.1 panel.example.com panel/' /etc/hosts
+ printf '127.0.1.1 %s %s\n' panel.example.com panel
+ grep -qE '^127\.0\.0\.1[[:space:]]+localhost' /etc/hosts
+ command -v ip
++ ip -4 route get 8.8.8.8
/workspace/instalacion_un_comando.sh: line 238: i: unbound variable
+ primary_ip=

## Estado servicios clave
- webmin: ACTIVO
- apache2: INACTIVO
- mysql: INACTIVO
- mariadb: INACTIVO
- postfix: INACTIVO
- dovecot: INACTIVO
- opendkim: INACTIVO
- spamassassin: INACTIVO
- clamav-daemon: INACTIVO
- clamav-freshclam: INACTIVO
- fail2ban: INACTIVO

## Puertos
udp   UNCONN 0      0            0.0.0.0:10000      0.0.0.0:*    users:(("miniserv.pl",pid=10170,fd=7)) ino:212122 sk:5 cgroup:/docker/dcf62950f2cb7e1a1485a4099ca3f1a0eff248a1a42c97771ab2f1381bb19620/system.slice/webmin.service <->     
tcp   LISTEN 0      4096         0.0.0.0:10000      0.0.0.0:*    users:(("miniserv.pl",pid=10170,fd=5)) ino:212120 sk:4001 cgroup:/docker/dcf62950f2cb7e1a1485a4099ca3f1a0eff248a1a42c97771ab2f1381bb19620/system.slice/webmin.service <->  
tcp   LISTEN 0      4096            [::]:10000         [::]:*    users:(("miniserv.pl",pid=10170,fd=6)) ino:212121 sk:4002 cgroup:/docker/dcf62950f2cb7e1a1485a4099ca3f1a0eff248a1a42c97771ab2f1381bb19620/system.slice/webmin.service v6only:1 <->

## Virtualmin check-config
virtualmin no disponible
